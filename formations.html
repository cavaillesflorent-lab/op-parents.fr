<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formations - OP! Ã‰ducation financiÃ¨re des parents</title>
    <meta name="description" content="DÃ©couvrez nos formations gratuites sur la gestion financiÃ¨re familiale. Des contenus pÃ©dagogiques pour comprendre et agir.">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- HEADER -->
    <div id="header-placeholder"></div>

    <main>
        <!-- HERO -->
        <section class="page-hero">
            <div class="page-hero-content">
                <span class="page-hero-badge">ðŸ“š Formations</span>
                <h1>Nos Formations</h1>
                <p>Des contenus pÃ©dagogiques pour comprendre, organiser et anticiper les finances de votre famille.</p>
            </div>
            <div class="page-hero-decoration">
                <div class="hero-circle circle-1"></div>
                <div class="hero-circle circle-2"></div>
                <div class="hero-circle circle-3"></div>
            </div>
        </section>

        <!-- STATS -->
        <section class="page-stats-section">
            <div class="page-stats">
                <div class="page-stat">
                    <div class="page-stat-icon">ðŸ“š</div>
                    <div class="page-stat-info">
                        <span class="page-stat-value" id="stat-formations">0</span>
                        <span class="page-stat-label">Formations</span>
                    </div>
                </div>
                <div class="page-stat-divider"></div>
                <div class="page-stat">
                    <div class="page-stat-icon">ðŸŽ¯</div>
                    <div class="page-stat-info">
                        <span class="page-stat-value" id="stat-modules">0</span>
                        <span class="page-stat-label">Modules</span>
                    </div>
                </div>
                <div class="page-stat-divider"></div>
                <div class="page-stat">
                    <div class="page-stat-icon">ðŸ†“</div>
                    <div class="page-stat-info">
                        <span class="page-stat-value">100%</span>
                        <span class="page-stat-label">Gratuit</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- LISTE -->
        <section class="page-list-section">
            <div class="container">
                <div class="formations-grid" id="formations-grid">
                    <div class="loading-state">
                        <div class="quiz-loading-spinner"></div>
                        <p>Chargement des formations...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA -->
        <section class="page-cta-section">
            <div class="container">
                <div class="page-cta-card">
                    <div class="page-cta-content">
                        <h2>Envie d'aller plus loin ?</h2>
                        <p>DÃ©couvre nos webinaires en direct pour approfondir tes connaissances avec des experts.</p>
                    </div>
                    <a href="webinaires.html" class="page-cta-btn">
                        Voir les webinaires
                        <span class="arrow">â†’</span>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/components.js"></script>
    <script>
        document.addEventListener('componentsLoaded', () => {
            initSupabase();
            loadFormations();
        });

        async function loadFormations() {
            try {
                const { data: formations, error } = await supabaseClient
                    .from('formations')
                    .select('*')
                    .eq('published', true)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const { data: modules } = await supabaseClient
                    .from('modules')
                    .select('formation_id');

                const moduleCounts = {};
                let totalModules = 0;
                modules?.forEach(m => {
                    moduleCounts[m.formation_id] = (moduleCounts[m.formation_id] || 0) + 1;
                    totalModules++;
                });

                // Mettre Ã  jour les stats
                document.getElementById('stat-formations').textContent = formations?.length || 0;
                document.getElementById('stat-modules').textContent = totalModules;

                displayFormations(formations || [], moduleCounts);
            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('formations-grid').innerHTML = `
                    <div class="page-empty">
                        <div class="page-empty-icon">ðŸ˜•</div>
                        <h3>Erreur de chargement</h3>
                        <p>Impossible de charger les formations.</p>
                    </div>
                `;
            }
        }

        function displayFormations(formations, moduleCounts) {
            const grid = document.getElementById('formations-grid');
            
            if (formations.length === 0) {
                grid.innerHTML = `
                    <div class="page-empty">
                        <div class="page-empty-icon">ðŸ“š</div>
                        <h3>Aucune formation disponible</h3>
                        <p>Les formations arrivent trÃ¨s bientÃ´t, reste connectÃ© !</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = formations.map(formation => `
                <article class="formation-card">
                    <a href="formation.html?id=${formation.id}" class="formation-card-link">
                        <div class="formation-card-image">
                            ${formation.image_url 
                                ? `<img src="${formation.image_url}" alt="${formation.titre}" loading="lazy">`
                                : `<div class="formation-card-placeholder"><span>ðŸ“š</span></div>`
                            }
                            <span class="formation-card-badge">Gratuit</span>
                        </div>
                        <div class="formation-card-body">
                            <h3 class="formation-card-title">${formation.titre}</h3>
                            ${formation.description ? `<p class="formation-card-description">${formation.description}</p>` : ''}
                            <div class="formation-card-meta">
                                <span>ðŸŽ¯ ${moduleCounts[formation.id] || 0} modules</span>
                            </div>
                            <div class="formation-card-footer">
                                <span class="formation-card-btn">
                                    DÃ©couvrir
                                    <span class="arrow">â†’</span>
                                </span>
                            </div>
                        </div>
                    </a>
                </article>
            `).join('');
        }
    </script>
</body>
</html>