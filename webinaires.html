<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webinaires - OP! Ã‰ducation financiÃ¨re des parents</title>
    <meta name="description" content="Participez Ã  nos webinaires gratuits sur la gestion financiÃ¨re familiale. En direct ou en replay.">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- HEADER (chargÃ© dynamiquement) -->
    <div id="header-placeholder"></div>

    <!-- HERO -->
    <section class="page-hero">
        <div class="page-hero-decoration">
            <div class="hero-circle circle-1"></div>
            <div class="hero-circle circle-2"></div>
            <div class="hero-circle circle-3"></div>
        </div>
        <div class="container">
            <div class="page-hero-content">
                <span class="page-hero-badge">ğŸ¥ Webinaires</span>
                <h1>Nos Webinaires</h1>
                <p>Des sessions en direct et en replay pour approfondir vos connaissances financiÃ¨res en famille.</p>
            </div>
        </div>
    </section>

    <!-- STATS -->
    <section class="page-stats-section">
        <div class="container">
            <div class="page-stats">
                <div class="page-stat">
                    <span class="page-stat-icon">ğŸ¬</span>
                    <div class="page-stat-info">
                        <span class="page-stat-value" id="stat-total">-</span>
                        <span class="page-stat-label">Webinaires</span>
                    </div>
                </div>
                <div class="page-stat-divider"></div>
                <div class="page-stat">
                    <span class="page-stat-icon">â–¶ï¸</span>
                    <div class="page-stat-info">
                        <span class="page-stat-value" id="stat-replays">-</span>
                        <span class="page-stat-label">Replays dispos</span>
                    </div>
                </div>
                <div class="page-stat-divider"></div>
                <div class="page-stat">
                    <span class="page-stat-icon">ğŸ“…</span>
                    <div class="page-stat-info">
                        <span class="page-stat-value" id="stat-avenir">-</span>
                        <span class="page-stat-label">Ã€ venir</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FILTRES -->
    <section class="page-filters-section">
        <div class="container">
            <div class="page-filters">
                <button class="page-filter-btn active" data-filter="all">Tous</button>
                <button class="page-filter-btn" data-filter="a_venir">Ã€ venir</button>
                <button class="page-filter-btn" data-filter="replay">Replays</button>
            </div>
        </div>
    </section>

    <!-- LISTE -->
    <section class="page-list-section">
        <div class="container">
            <div class="webinaires-grid" id="webinaires-grid">
                <div class="loading-state">
                    <div class="quiz-loading-spinner"></div>
                    <p>Chargement des webinaires...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA -->
    <section class="page-cta-section">
        <div class="container">
            <div class="page-cta-card">
                <div class="page-cta-content">
                    <h2>Une idÃ©e de webinaire ?</h2>
                    <p>Propose-nous un sujet qui t'intÃ©resse, on le traitera peut-Ãªtre dans un prochain live !</p>
                </div>
                <a href="contact.html" class="page-cta-btn">
                    Proposer un sujet <span class="arrow">â†’</span>
                </a>
            </div>
        </div>
    </section>

    <!-- FOOTER (chargÃ© dynamiquement) -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/components.js"></script>
    <script>
        let allWebinaires = [];
        let currentFilter = 'all';

        // Attendre que les composants soient chargÃ©s
        document.addEventListener('componentsLoaded', () => {
            initSupabase();
            loadWebinaires();
            initFilters();
        });

        // GÃ©nÃ©rer une carte webinaire (nouveau design)
        function generateWebinaireCard(webinaire) {
            const status = webinaire.statut || 'replay';
            const statusLabels = {
                'a_venir': 'Ã€ venir',
                'replay': 'Replay',
                'termine': 'TerminÃ©'
            };
            const statusLabel = statusLabels[status] || 'Replay';

            // Date pour les webinaires Ã  venir
            let dateBlock = '';
            if (status === 'a_venir' && webinaire.date_heure) {
                const date = new Date(webinaire.date_heure);
                const options = { 
                    weekday: 'long', 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                const formattedDate = date.toLocaleDateString('fr-FR', options);
                dateBlock = `
                    <div class="webinaire-date-block">
                        <span class="webinaire-date-icon">ğŸ“…</span>
                        <span class="webinaire-date-text">${formattedDate}</span>
                    </div>
                `;
            }

            // Bloc intervenant
            let speakerBlock = '';
            const speakerName = webinaire.speaker_name || webinaire.intervenant || '';
            const speakerTitle = webinaire.speaker_title || webinaire.intervenant_titre || '';
            const speakerAvatar = webinaire.speaker_avatar || webinaire.intervenant_photo || null;
            
            if (speakerName) {
                const avatarContent = speakerAvatar 
                    ? `<img src="${speakerAvatar}" alt="${speakerName}">`
                    : `<div class="webinaire-speaker-avatar-placeholder">ğŸ‘¤</div>`;
                
                speakerBlock = `
                    <div class="webinaire-speaker">
                        <div class="webinaire-speaker-avatar">
                            ${avatarContent}
                        </div>
                        <div class="webinaire-speaker-info">
                            <span class="webinaire-speaker-prefix">Avec</span>
                            <span class="webinaire-speaker-name">${speakerName}</span>
                            ${speakerTitle ? `<span class="webinaire-speaker-title">${speakerTitle}</span>` : ''}
                        </div>
                    </div>
                `;
            }

            // Bouton â†’ TOUJOURS vers la page dÃ©tail
            let buttonHTML = '';
            const detailUrl = `webinaire-detail.html?id=${webinaire.id}`;
            
            switch(status) {
                case 'a_venir':
                    buttonHTML = `
                        <a href="${detailUrl}" class="webinaire-btn upcoming">
                            Voir les dÃ©tails & s'inscrire
                        </a>
                    `;
                    break;
                case 'replay':
                    buttonHTML = `
                        <a href="${detailUrl}" class="webinaire-btn replay">
                            Voir le webinaire
                        </a>
                    `;
                    break;
                case 'termine':
                default:
                    buttonHTML = `
                        <a href="${detailUrl}" class="webinaire-btn disabled">
                            Voir les dÃ©tails
                        </a>
                    `;
                    break;
            }

            // Assembler la carte (cliquable entiÃ¨rement)
            return `
                <a href="${detailUrl}" class="webinaire-card-link">
                    <div class="webinaire-card" data-status="${status}">
                        <span class="webinaire-badge status-${status}">${statusLabel}</span>
                        <h3 class="webinaire-title">${webinaire.titre || 'Webinaire sans titre'}</h3>
                        ${dateBlock}
                        ${speakerBlock}
                        ${webinaire.description ? `<p class="webinaire-description">${webinaire.description}</p>` : ''}
                        ${buttonHTML}
                    </div>
                </a>
            `;
        }

        // Charger les webinaires
        async function loadWebinaires() {
            const grid = document.getElementById('webinaires-grid');
            
            try {
                const { data, error } = await supabaseClient
                    .from('webinaires')
                    .select('*')
                    .order('date_heure', { ascending: false });

                if (error) throw error;

                allWebinaires = data || [];
                
                // Mettre Ã  jour les stats
                document.getElementById('stat-total').textContent = allWebinaires.length;
                document.getElementById('stat-replays').textContent = allWebinaires.filter(w => w.statut === 'replay').length;
                document.getElementById('stat-avenir').textContent = allWebinaires.filter(w => w.statut === 'a_venir').length;

                displayWebinaires();
                
            } catch (error) {
                console.error('Erreur:', error);
                grid.innerHTML = `
                    <div class="page-empty">
                        <span class="page-empty-icon">ğŸ˜•</span>
                        <h3>Erreur de chargement</h3>
                        <p>Impossible de charger les webinaires.</p>
                        <button class="btn btn-primary" onclick="loadWebinaires()">RÃ©essayer</button>
                    </div>
                `;
            }
        }

        // Afficher les webinaires filtrÃ©s
        function displayWebinaires() {
            const grid = document.getElementById('webinaires-grid');
            
            let filtered = allWebinaires;
            if (currentFilter !== 'all') {
                filtered = allWebinaires.filter(w => w.statut === currentFilter);
            }

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="page-empty">
                        <span class="page-empty-icon">ğŸ¥</span>
                        <h3>Aucun webinaire</h3>
                        <p>${currentFilter === 'a_venir' ? 'Aucun webinaire prÃ©vu pour le moment.' : 'Aucun webinaire dans cette catÃ©gorie.'}</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(w => generateWebinaireCard(w)).join('');
        }

        // Initialiser les filtres
        function initFilters() {
            document.querySelectorAll('.page-filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.page-filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    displayWebinaires();
                });
            });
        }
    </script>
</body>
</html>