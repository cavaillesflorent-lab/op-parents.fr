<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webinaires - OP! √âducation financi√®re des parents</title>
    <meta name="description" content="Participez √† nos webinaires gratuits sur la gestion financi√®re familiale. En direct ou en replay.">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/style-responsive.css">
    <style>
        /* ===== LAYOUT WEBINAIRES (div, pas section ‚Üí √©chappe aux r√®gles globales) ===== */
        .wb-hero {
            padding: 2rem 0 1rem;
            background: #f8f9fa;
            text-align: center;
        }
        
        .wb-hero .page-hero-content {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .wb-hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.25rem;
            font-weight: 700;
            color: #2D403B;
            margin-bottom: 1rem;
            line-height: 1.25;
        }
        
        .wb-hero p {
            font-size: 1.1rem;
            color: #4A5854;
            line-height: 1.6;
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .wb-hero h1 {
                font-size: 1.5rem;
            }
            
            .wb-hero p {
                font-size: 1rem;
            }
        }
        
        .wb-stats {
            padding: 0 0 0.5rem;
        }
        .wb-content {
            padding: 1rem 0 2rem;
        }
        .wb-cta {
            padding: 2rem 0;
        }
        
        /* ===== FILTRES ===== */
        .page-filters {
            display: flex !important;
            gap: 0.5rem !important;
            margin-bottom: 1.5rem !important;
            flex-wrap: wrap !important;
        }
        
        .page-filter-btn {
            padding: 0.5rem 1.25rem;
            border-radius: 50px;
            border: 2px solid #2D403B;
            background: transparent;
            color: #2D403B;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .page-filter-btn:hover {
            background: rgba(45, 64, 59, 0.08);
        }
        
        .page-filter-btn.active {
            background: #2D403B;
            color: #fff;
        }

        /* ===== GRILLE WEBINAIRES - 3 colonnes forc√©es ===== */
        .webinaires-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            align-items: stretch;
        }
        
        @media (max-width: 1024px) {
            .webinaires-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 640px) {
            .webinaires-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }
        
        /* ===== CARTE WEBINAIRE MODERNE ===== */
        .webinaire-card {
            background: #fff;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(45, 64, 59, 0.08);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
            text-decoration: none;
            color: inherit;
        }
        
        .webinaire-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(45, 64, 59, 0.15);
        }
        
        /* Header de la carte avec gradient */
        .webinaire-card-header {
            background: linear-gradient(135deg, #DFF2B6 0%, #c5e090 100%);
            padding: 1.25rem;
            position: relative;
        }
        
        .webinaire-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }
        
        .webinaire-badge.status-a_venir {
            background: #F2D680;
            color: #2D403B;
        }
        
        .webinaire-badge.status-replay {
            background: #2D403B;
            color: #fff;
        }
        
        .webinaire-badge.status-termine {
            background: #ADB5B2;
            color: #fff;
        }
        
        .webinaire-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.15rem;
            font-weight: 600;
            color: #2D403B;
            margin: 0.75rem 0 0;
            line-height: 1.3;
        }
        
        /* Body de la carte */
        .webinaire-card-body {
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        /* Date */
        .webinaire-date {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 0.85rem;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.85rem;
            color: #2D403B;
            margin-bottom: 1rem;
        }
        
        .webinaire-date-icon {
            font-size: 1rem;
        }
        
        /* Intervenant */
        .webinaire-speaker {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .webinaire-speaker-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            overflow: hidden;
            background: #DFF2B6;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .webinaire-speaker-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .webinaire-speaker-avatar-placeholder {
            font-size: 1.25rem;
        }
        
        .webinaire-speaker-info {
            display: flex;
            flex-direction: column;
            gap: 0.1rem;
        }
        
        .webinaire-speaker-prefix {
            font-size: 0.7rem;
            color: #6C7A75;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .webinaire-speaker-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: #2D403B;
        }
        
        .webinaire-speaker-title {
            font-size: 0.8rem;
            color: #6C7A75;
        }
        
        /* Description */
        .webinaire-description {
            font-size: 0.9rem;
            color: #4A5854;
            line-height: 1.5;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Footer avec bouton */
        .webinaire-card-footer {
            margin-top: auto;
            padding-top: 0.5rem;
        }
        
        .webinaire-btn {
            display: block;
            width: 100%;
            padding: 0.85rem 1.25rem;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            border-radius: 12px;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .webinaire-btn.upcoming {
            background: #2D403B;
            color: #fff;
        }
        
        .webinaire-btn.upcoming:hover {
            background: #3D5550;
        }
        
        .webinaire-btn.replay {
            background: #F2D680;
            color: #2D403B;
        }
        
        .webinaire-btn.replay:hover {
            background: #e8c45a;
        }
        
        .webinaire-btn.disabled {
            background: #e9eceb;
            color: #6C7A75;
        }
        
        /* √âtat vide */
        .page-empty {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem 2rem;
        }
        
        .page-empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }
        
        .page-empty h3 {
            font-size: 1.25rem;
            color: #2D403B;
            margin-bottom: 0.5rem;
        }
        
        .page-empty p {
            color: #6C7A75;
        }
        
        /* Loading */
        .loading-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem 2rem;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e9eceb;
            border-top-color: #2D403B;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- HEADER (charg√© dynamiquement) -->
    <div id="header-placeholder"></div>

    <!-- HERO -->
    <div class="wb-hero">
        <div class="container">
            <div class="page-hero-content">
                <h1>Les sujets qu'on repousse, expliqu√©s simplement</h1>
                <p>Un webinaire par mois sur les vraies questions des parents : imp√¥ts, √©pargne, couple, transmission... 45 min pour comprendre, sans jargon.</p>
            </div>
        </div>
    </div>

    <!-- STATS -->
    <div class="wb-stats">
        <div class="container">
            <div class="page-stats">
                <div class="page-stat">
                    <span class="page-stat-icon">üé¨</span>
                    <div class="page-stat-info">
                        <span class="page-stat-value" id="stat-total">-</span>
                        <span class="page-stat-label">Webinaires</span>
                    </div>
                </div>
                <div class="page-stat-divider"></div>
                <div class="page-stat">
                    <span class="page-stat-icon">‚ñ∂Ô∏è</span>
                    <div class="page-stat-info">
                        <span class="page-stat-value" id="stat-replays">-</span>
                        <span class="page-stat-label">Replays dispos</span>
                    </div>
                </div>
                <div class="page-stat-divider"></div>
                <div class="page-stat">
                    <span class="page-stat-icon">üìÖ</span>
                    <div class="page-stat-info">
                        <span class="page-stat-value" id="stat-avenir">-</span>
                        <span class="page-stat-label">√Ä venir</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTENU (filtres + grille) -->
    <div class="wb-content">
        <div class="container">
            <div class="page-filters">
                <button class="page-filter-btn active" data-filter="all">Tous</button>
                <button class="page-filter-btn" data-filter="a_venir">√Ä venir</button>
                <button class="page-filter-btn" data-filter="replay">Replays</button>
            </div>
            <div class="webinaires-grid" id="webinaires-grid">
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Chargement des webinaires...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- CTA -->
    <div class="wb-cta">
        <div class="container">
            <div class="page-cta-card">
                <div class="page-cta-content">
                   <h2>Envie d'aller plus loin ?</h2>
                    <p>Les webinaires t'ont donn√© les bases. Pour un regard expert sur ta situation, √©change avec Florent.</p>
                    <a href="investir.html" class="page-cta-btn">
                        Parler √† Florent <span class="arrow">‚Üí</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER (charg√© dynamiquement) -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/components.js"></script>
    <script>
        let allWebinaires = [];
        let currentFilter = 'all';

        // Attendre que les composants soient charg√©s
        document.addEventListener('componentsLoaded', () => {
            initSupabase();
            loadWebinaires();
            initFilters();
        });

        // G√©n√©rer une carte webinaire MODERNE
        function generateWebinaireCard(webinaire) {
            const status = webinaire.statut || 'replay';
            const statusConfig = {
                'a_venir': { label: 'üìÖ √Ä venir', class: 'status-a_venir', btnText: 'S\'inscrire', btnClass: 'upcoming' },
                'replay': { label: '‚ñ∂Ô∏è Replay', class: 'status-replay', btnText: 'Voir le replay', btnClass: 'replay' },
                'termine': { label: '‚úì Termin√©', class: 'status-termine', btnText: 'Voir les d√©tails', btnClass: 'disabled' }
            };
            const config = statusConfig[status] || statusConfig['replay'];

            // Date format√©e
            let dateBlock = '';
            if (webinaire.date_heure) {
                const date = new Date(webinaire.date_heure);
                const options = { 
                    weekday: 'long', 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                const formattedDate = date.toLocaleDateString('fr-FR', options);
                dateBlock = `
                    <div class="webinaire-date">
                        <span class="webinaire-date-icon">üóìÔ∏è</span>
                        <span>${formattedDate}</span>
                    </div>
                `;
            }

            // Intervenant
            let speakerBlock = '';
            const speakerName = webinaire.speaker_name || webinaire.intervenant || '';
            const speakerTitle = webinaire.speaker_title || webinaire.intervenant_titre || '';
            const speakerAvatar = webinaire.speaker_avatar || webinaire.intervenant_photo || null;
            
            if (speakerName) {
                const avatarContent = speakerAvatar 
                    ? `<img src="${speakerAvatar}" alt="${speakerName}">`
                    : `<div class="webinaire-speaker-avatar-placeholder">üë§</div>`;
                
                speakerBlock = `
                    <div class="webinaire-speaker">
                        <div class="webinaire-speaker-avatar">${avatarContent}</div>
                        <div class="webinaire-speaker-info">
                            <span class="webinaire-speaker-prefix">Avec</span>
                            <span class="webinaire-speaker-name">${speakerName}</span>
                            ${speakerTitle ? `<span class="webinaire-speaker-title">${speakerTitle}</span>` : ''}
                        </div>
                    </div>
                `;
            }

            // Description tronqu√©e
            const description = webinaire.description 
                ? `<p class="webinaire-description">${webinaire.description}</p>` 
                : '';

            const detailUrl = `webinaire-detail.html?id=${webinaire.id}`;

            // Carte moderne
            return `
                <a href="${detailUrl}" class="webinaire-card" data-status="${status}">
                    <div class="webinaire-card-header">
                        <span class="webinaire-badge ${config.class}">${config.label}</span>
                        <h3 class="webinaire-title">${webinaire.titre || 'Webinaire sans titre'}</h3>
                    </div>
                    <div class="webinaire-card-body">
                        ${dateBlock}
                        ${speakerBlock}
                        ${description}
                        <div class="webinaire-card-footer">
                            <span class="webinaire-btn ${config.btnClass}">${config.btnText}</span>
                        </div>
                    </div>
                </a>
            `;
        }

        // Trier les webinaires intelligemment
        function sortWebinaires(webinaires) {
            const aVenir = webinaires.filter(w => w.statut === 'a_venir');
            const replays = webinaires.filter(w => w.statut === 'replay');
            const termines = webinaires.filter(w => w.statut === 'termine' || (!w.statut && w.statut !== 'a_venir' && w.statut !== 'replay'));
            
            // √Ä venir : date croissante
            aVenir.sort((a, b) => {
                const dateA = a.date_heure ? new Date(a.date_heure) : new Date(9999, 11, 31);
                const dateB = b.date_heure ? new Date(b.date_heure) : new Date(9999, 11, 31);
                return dateA - dateB;
            });
            
            // Replay : date d√©croissante
            replays.sort((a, b) => {
                const dateA = a.date_heure ? new Date(a.date_heure) : new Date(0);
                const dateB = b.date_heure ? new Date(b.date_heure) : new Date(0);
                return dateB - dateA;
            });
            
            // Termin√© : date d√©croissante
            termines.sort((a, b) => {
                const dateA = a.date_heure ? new Date(a.date_heure) : new Date(0);
                const dateB = b.date_heure ? new Date(b.date_heure) : new Date(0);
                return dateB - dateA;
            });
            
            return [...aVenir, ...replays, ...termines];
        }

        // Charger les webinaires
        async function loadWebinaires() {
            const grid = document.getElementById('webinaires-grid');
            
            try {
                const { data, error } = await supabaseClient
                    .from('webinaires')
                    .select('*');

                if (error) throw error;

                allWebinaires = sortWebinaires(data || []);
                
                // Stats
                document.getElementById('stat-total').textContent = allWebinaires.length;
                document.getElementById('stat-replays').textContent = allWebinaires.filter(w => w.statut === 'replay').length;
                document.getElementById('stat-avenir').textContent = allWebinaires.filter(w => w.statut === 'a_venir').length;

                displayWebinaires();
                
            } catch (error) {
                console.error('Erreur:', error);
                grid.innerHTML = `
                    <div class="page-empty">
                        <span class="page-empty-icon">üòï</span>
                        <h3>Erreur de chargement</h3>
                        <p>Impossible de charger les webinaires.</p>
                        <button class="btn btn-primary" onclick="loadWebinaires()">R√©essayer</button>
                    </div>
                `;
            }
        }

        // Afficher les webinaires filtr√©s
        function displayWebinaires() {
            const grid = document.getElementById('webinaires-grid');
            
            let filtered = allWebinaires;
            if (currentFilter !== 'all') {
                filtered = allWebinaires.filter(w => w.statut === currentFilter);
            }

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="page-empty">
                        <span class="page-empty-icon">üé•</span>
                        <h3>Aucun webinaire</h3>
                        <p>${currentFilter === 'a_venir' ? 'Aucun webinaire pr√©vu pour le moment.' : 'Aucun webinaire dans cette cat√©gorie.'}</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(w => generateWebinaireCard(w)).join('');
        }

        // Initialiser les filtres
        function initFilters() {
            document.querySelectorAll('.page-filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.page-filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    displayWebinaires();
                });
            });
        }
    </script>
</body>
</html>