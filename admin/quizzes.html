<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Quiz - Admin OP!</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/admin.css">
    <link rel="stylesheet" href="../assets/css/admin-quiz.css">
</head>
<body class="admin-body">
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <img src="../assets/images/logo.png" alt="OP!" class="sidebar-logo">
                <span>Administration</span>
            </div>
            <nav class="sidebar-nav">
                <a href="index.html" class="nav-item">
                    <span class="nav-icon">üìä</span>
                    Dashboard
                </a>
                <a href="webinaires.html" class="nav-item">
                    <span class="nav-icon">üé•</span>
                    Webinaires
                </a>
                <a href="formations.html" class="nav-item">
                    <span class="nav-icon">üìö</span>
                    Formations
                </a>
                <a href="quizzes.html" class="nav-item active">
                    <span class="nav-icon">üß†</span>
                    Quiz
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="../index.html" class="nav-item">
                    <span class="nav-icon">üè†</span>
                    Voir le site
                </a>
                <button class="nav-item logout-btn" id="logout-btn">
                    <span class="nav-icon">üö™</span>
                    D√©connexion
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <header class="admin-header">
                <h1>Gestion des Quiz</h1>
                <button class="btn btn-primary" id="new-quiz-btn">
                    ‚ûï Nouveau quiz
                </button>
            </header>

            <div class="admin-content">
                <!-- Stats rapides -->
                <div class="quiz-stats-bar">
                    <div class="stat-item">
                        <span class="stat-value" id="total-quizzes">-</span>
                        <span class="stat-label">Quiz cr√©√©s</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="total-responses">-</span>
                        <span class="stat-label">R√©ponses totales</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="published-quizzes">-</span>
                        <span class="stat-label">Quiz publi√©s</span>
                    </div>
                </div>

                <!-- Liste des quiz -->
                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Quiz</th>
                                <th>Questions</th>
                                <th>R√©ponses</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="quizzes-list">
                            <tr>
                                <td colspan="5" class="loading">Chargement...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL CR√âATION/√âDITION QUIZ (Plein √©cran) -->
    <div class="quiz-editor-modal" id="quiz-editor-modal">
        <div class="quiz-editor">
            <!-- Header -->
            <header class="editor-header">
                <div class="editor-header-left">
                    <button class="btn-back" id="btn-back">
                        ‚Üê Retour
                    </button>
                    <h1 id="editor-title">Nouveau Quiz</h1>
                </div>
                <div class="editor-header-right">
                    <span class="save-status" id="save-status"></span>
                    <button class="btn btn-secondary" id="btn-preview">
                        üëÅÔ∏è Aper√ßu
                    </button>
                    <button class="btn btn-primary" id="btn-save">
                        üíæ Enregistrer
                    </button>
                </div>
            </header>

            <!-- Navigation Onglets -->
            <nav class="editor-tabs">
                <button class="tab-btn active" data-tab="intro">
                    <span class="tab-icon">üéØ</span>
                    <span class="tab-label">Introduction</span>
                </button>
                <button class="tab-btn" data-tab="questions">
                    <span class="tab-icon">‚ùì</span>
                    <span class="tab-label">Questions</span>
                </button>
                <button class="tab-btn" data-tab="profiles">
                    <span class="tab-icon">üë§</span>
                    <span class="tab-label">Profils de r√©sultat</span>
                </button>
                <button class="tab-btn" data-tab="conclusion">
                    <span class="tab-icon">üèÜ</span>
                    <span class="tab-label">Conclusion</span>
                </button>
                <button class="tab-btn" data-tab="settings">
                    <span class="tab-icon">‚öôÔ∏è</span>
                    <span class="tab-label">Param√®tres</span>
                </button>
            </nav>

            <!-- Contenu des onglets -->
            <div class="editor-content">
                
                <!-- TAB: Introduction -->
                <div class="tab-panel active" id="panel-intro">
                    <div class="panel-section">
                        <h2>Pr√©sentation du Quiz</h2>
                        <p class="section-desc">Ces informations seront affich√©es sur l'√©cran d'accueil du quiz, avant que l'utilisateur ne commence.</p>
                        
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="quiz-title">Titre du quiz *</label>
                                <input type="text" id="quiz-title" placeholder="Ex: Quel est ton mindset par rapport √† l'argent ?">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="quiz-subtitle">Sous-titre / Accroche</label>
                                <input type="text" id="quiz-subtitle" placeholder="Ex: D√©couvre ton profil financier en 3 minutes">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="quiz-description">Description</label>
                                <textarea id="quiz-description" rows="3" placeholder="Courte description du quiz et de son objectif..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="panel-section">
                        <h2>Statistique d'accroche</h2>
                        <p class="section-desc">Une statistique impactante pour capter l'attention (optionnel).</p>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="intro-stat">Statistique</label>
                                <input type="text" id="intro-stat" placeholder="Ex: 67% des Fran√ßais reproduisent les habitudes financi√®res de leurs parents">
                            </div>
                            <div class="form-group">
                                <label for="intro-stat-source">Source</label>
                                <input type="text" id="intro-stat-source" placeholder="Ex: √âtude IFOP 2024">
                            </div>
                        </div>
                    </div>

                    <div class="panel-section">
                        <h2>Ce que l'utilisateur va apprendre</h2>
                        <p class="section-desc">Liste des b√©n√©fices affich√©s sous "√Ä la fin de ce quiz, tu sauras :"</p>
                        
                        <div class="benefits-list" id="benefits-list">
                            <div class="benefit-item">
                                <span class="benefit-icon">‚úì</span>
                                <input type="text" class="benefit-input" placeholder="Ex: Si ton rapport √† l'argent est domin√© par la s√©curit√© ou la libert√©">
                                <button class="btn-remove-benefit" title="Supprimer">√ó</button>
                            </div>
                        </div>
                        <button class="btn btn-secondary btn-sm" id="add-benefit-btn">
                            + Ajouter un b√©n√©fice
                        </button>
                    </div>

                    <div class="panel-section">
                        <h2>Encart scientifique (optionnel)</h2>
                        <p class="section-desc">Un encart "Le saviez-vous ?" pour cr√©dibiliser le quiz.</p>
                        
                        <div class="form-group full-width">
                            <label for="intro-scientific">Texte scientifique</label>
                            <textarea id="intro-scientific" rows="4" placeholder="Ex: Les chercheurs en psychologie financi√®re ont d√©montr√© que nos premi√®res croyances sur l'argent se forment avant 7 ans..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- TAB: Questions -->
                <div class="tab-panel" id="panel-questions">
                    <div class="questions-header">
                        <h2>Questions du Quiz</h2>
                        <button class="btn btn-primary" id="add-question-btn">
                            ‚ûï Ajouter une question
                        </button>
                    </div>

                    <div class="questions-container" id="questions-container">
                        <div class="empty-state">
                            <div class="empty-icon">‚ùì</div>
                            <h3>Aucune question</h3>
                            <p>Cliquez sur "Ajouter une question" pour commencer √† cr√©er votre quiz.</p>
                        </div>
                    </div>
                </div>

                <!-- TAB: Profils -->
                <div class="tab-panel" id="panel-profiles">
                    <div class="panel-section">
                        <h2>Profils de R√©sultat</h2>
                        <p class="section-desc">D√©finissez les diff√©rents profils que les utilisateurs peuvent obtenir selon leurs r√©ponses. Chaque r√©ponse sera associ√©e √† un de ces profils.</p>
                        
                        <div class="profiles-container" id="profiles-container">
                            <!-- Les profils seront ajout√©s ici -->
                        </div>
                        
                        <button class="btn btn-secondary" id="add-profile-btn">
                            ‚ûï Ajouter un profil
                        </button>
                    </div>
                </div>

                <!-- TAB: Conclusion -->
                <div class="tab-panel" id="panel-conclusion">
                    <div class="panel-section">
                        <h2>Message de conclusion</h2>
                        <p class="section-desc">Ce message s'affiche apr√®s le r√©sultat du quiz.</p>
                        
                        <div class="form-group full-width">
                            <label for="conclusion-title">Titre de conclusion</label>
                            <input type="text" id="conclusion-title" placeholder="Ex: Le Vrai Changement de Mindset">
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Ce que ce n'est PAS</label>
                                <div class="list-editor" id="conclusion-not-list">
                                    <div class="list-item">
                                        <span class="list-icon">‚ùå</span>
                                        <input type="text" placeholder="Ex: Gagner plus">
                                        <button class="btn-remove">√ó</button>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-ghost add-list-item" data-target="conclusion-not-list">+ Ajouter</button>
                            </div>
                            
                            <div class="form-group">
                                <label>Ce que c'EST</label>
                                <div class="list-editor" id="conclusion-is-list">
                                    <div class="list-item">
                                        <span class="list-icon">‚úÖ</span>
                                        <input type="text" placeholder="Ex: Te sentir l√©gitime">
                                        <button class="btn-remove">√ó</button>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-ghost add-list-item" data-target="conclusion-is-list">+ Ajouter</button>
                            </div>
                        </div>
                    </div>

                    <div class="panel-section">
                        <h2>Message final</h2>
                        
                        <div class="form-group full-width">
                            <label for="conclusion-quote">Citation / Message cl√©</label>
                            <input type="text" id="conclusion-quote" placeholder="Ex: La libert√© financi√®re commence par la libert√© de d√©cision">
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="conclusion-cta">Texte Call-to-Action</label>
                            <input type="text" id="conclusion-cta" placeholder="Ex: Tu viens de faire le premier pas. Maintenant, on passe √† l'action ?">
                        </div>
                    </div>
                </div>

                <!-- TAB: Param√®tres -->
                <div class="tab-panel" id="panel-settings">
                    <div class="panel-section">
                        <h2>Param√®tres g√©n√©raux</h2>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="quiz-slug">Slug (URL) *</label>
                                <input type="text" id="quiz-slug" placeholder="mindset-financier">
                                <small class="form-hint">URL: /quiz.html?quiz=<strong id="slug-preview">mindset-financier</strong></small>
                            </div>
                            
                            <div class="form-group">
                                <label for="quiz-duration">Dur√©e estim√©e</label>
                                <input type="text" id="quiz-duration" placeholder="3 min" value="3 min">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="quiz-image">Image de couverture (URL)</label>
                            <input type="url" id="quiz-image" placeholder="https://...">
                        </div>
                    </div>

                    <div class="panel-section">
                        <h2>Publication</h2>
                        
                        <div class="toggle-group">
                            <label class="toggle">
                                <input type="checkbox" id="quiz-published">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Quiz publi√© (visible sur le site)</span>
                            </label>
                        </div>
                        
                        <div class="toggle-group">
                            <label class="toggle">
                                <input type="checkbox" id="quiz-collect-email">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Proposer de collecter l'email √† la fin</span>
                            </label>
                        </div>
                        
                        <div class="toggle-group">
                            <label class="toggle">
                                <input type="checkbox" id="quiz-show-progress" checked>
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Afficher la barre de progression</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL QUESTION -->
    <div class="modal" id="question-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h2 id="question-modal-title">Nouvelle Question</h2>
                <button class="modal-close" id="question-modal-close">√ó</button>
            </div>
            
            <div class="modal-body">
                <input type="hidden" id="question-edit-index" value="-1">
                
                <!-- Type de question -->
                <div class="question-type-selector">
                    <label>Type de question</label>
                    <div class="type-options">
                        <label class="type-option active">
                            <input type="radio" name="question-type" value="single" checked>
                            <span class="type-card">
                                <span class="type-icon">‚óâ</span>
                                <span class="type-name">Choix unique</span>
                                <span class="type-desc">Une seule r√©ponse possible</span>
                            </span>
                        </label>
                        <label class="type-option">
                            <input type="radio" name="question-type" value="multiple">
                            <span class="type-card">
                                <span class="type-icon">‚òëÔ∏è</span>
                                <span class="type-name">Choix multiple</span>
                                <span class="type-desc">Plusieurs r√©ponses possibles</span>
                            </span>
                        </label>
                        <label class="type-option">
                            <input type="radio" name="question-type" value="profile">
                            <span class="type-card">
                                <span class="type-icon">üë§</span>
                                <span class="type-name">Profil</span>
                                <span class="type-desc">Associe chaque r√©ponse √† un profil</span>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Contexte -->
                <div class="form-section collapsible">
                    <div class="section-header" data-toggle="context-section">
                        <h3>üìö Contexte (optionnel)</h3>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content collapsed" id="context-section">
                        <div class="form-group">
                            <label for="question-context-title">Titre du contexte</label>
                            <input type="text" id="question-context-title" placeholder="Ex: S√âQUENCE 1 ‚Äî L'H√©ritage Invisible">
                        </div>
                        <div class="form-group">
                            <label for="question-context">Texte de contexte</label>
                            <textarea id="question-context" rows="3" placeholder="Ex: Dans 63% des familles fran√ßaises, les enfants ne connaissaient pas les revenus de leurs parents..."></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="question-stat">Statistique mise en avant</label>
                                <input type="text" id="question-stat" placeholder="Ex: 90% des jeunes ont entendu...">
                            </div>
                            <div class="form-group">
                                <label for="question-stat-source">Source</label>
                                <input type="text" id="question-stat-source" placeholder="Ex: √âtude IFOP 2024">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Question -->
                <div class="form-section">
                    <h3>‚ùì Question</h3>
                    <div class="form-group">
                        <label for="question-text">Texte de la question *</label>
                        <textarea id="question-text" rows="2" placeholder="Ex: Quand tu √©tais enfant, l'argent √©tait surtout..." required></textarea>
                    </div>
                </div>

                <!-- R√©ponses -->
                <div class="form-section">
                    <h3>üí¨ R√©ponses</h3>
                    <p class="section-desc">Ajoutez les r√©ponses possibles. Pour chaque r√©ponse, vous pouvez indiquer si elle est correcte et ajouter une explication.</p>
                    
                    <div class="answers-builder" id="answers-builder">
                        <!-- Les r√©ponses seront ajout√©es ici -->
                    </div>
                    
                    <button class="btn btn-secondary btn-sm" id="add-answer-btn">
                        ‚ûï Ajouter une r√©ponse
                    </button>
                </div>

                <!-- Feedback apr√®s r√©ponse -->
                <div class="form-section collapsible">
                    <div class="section-header" data-toggle="feedback-section">
                        <h3>üí° Feedback apr√®s r√©ponse (optionnel)</h3>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div class="section-content collapsed" id="feedback-section">
                        <div class="form-group">
                            <label for="question-insight">Message insight</label>
                            <textarea id="question-insight" rows="2" placeholder="Ex: Le ressenti n'est pas li√© au montant sur ton compte, mais √† la signification √©motionnelle que tu donnes √† l'argent."></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="question-cancel-btn">Annuler</button>
                <button class="btn btn-primary" id="question-save-btn">Enregistrer la question</button>
            </div>
        </div>
    </div>

    <!-- Modal Suppression -->
    <div class="modal" id="delete-modal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Confirmer la suppression</h2>
                <button class="modal-close" id="delete-modal-close">√ó</button>
            </div>
            <p>√ätes-vous s√ªr de vouloir supprimer ce quiz ? Cette action est irr√©versible.</p>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="delete-cancel">Annuler</button>
                <button class="btn btn-danger" id="delete-confirm">Supprimer</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/admin-quiz.js"></script>
</body>
</html>