<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formation - OP!</title>
    <meta name="description" content="Formation OP! - √âducation financi√®re pour les parents">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <img src="assets/images/logo.png" alt="OP!" class="logo-img">
                    </a>
                    <span class="logo-text">booste tes finances !</span>
                </div>
                <nav class="nav">
                    <a href="formations.html" class="active"><span class="nav-icon">üìö</span> Formations</a>
                    <a href="webinaires.html"><span class="nav-icon">üé•</span> Webinaires</a>
                    <a href="index.html#investir"><span class="nav-icon">üí∞</span> Investir</a>
                    <a href="index.html#missions"><span class="nav-icon">üöÄ</span> Missions OP!</a>
                    <a href="index.html#contact"><span class="nav-icon">‚úâÔ∏è</span> Contact</a>
                </nav>
                <button class="mobile-toggle" aria-label="Menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <!-- CONTENU FORMATION -->
    <main class="formation-detail" id="formation-detail">
        <div class="loading-state">
            <p>Chargement de la formation...</p>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <div class="footer-logo">
                        <img src="assets/images/logo.png" alt="OP!" class="footer-logo-img">
                        <span class="footer-tagline">booste tes finances !</span>
                    </div>
                    <p>La plateforme d'√©ducation financi√®re d√©di√©e aux parents.</p>
                </div>
                
                <div class="footer-col">
                    <h4>Navigation</h4>
                    <ul>
                        <li><a href="formations.html">Formations</a></li>
                        <li><a href="webinaires.html">Webinaires</a></li>
                        <li><a href="index.html#investir">Investir</a></li>
                        <li><a href="index.html#missions">Missions OP!</a></li>
                        <li><a href="index.html#contact">Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h4>Suivez-nous</h4>
                    <div class="social-links">
                        <a href="https://instagram.com/op.parents" target="_blank">Instagram</a>
                        <a href="https://linkedin.com/company/op-parents" target="_blank">LinkedIn</a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 <a href="admin/login.html" class="admin-link">OP!</a> - Tous droits r√©serv√©s</p>
                <div class="footer-legal">
                    <a href="mentions-legales.html">Mentions l√©gales</a>
                    <a href="politique-confidentialite.html">Confidentialit√©</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // ‚ö†Ô∏è REMPLACE CES VALEURS PAR TES CL√âS SUPABASE ‚ö†Ô∏è
        const SUPABASE_URL = 'https://qjdoepgvqpmckqnxcsob.supabase.co'; // Remplace XXXXX par ton URL
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqZG9lcGd2cXBtY2txbnhjc29iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4NDIxNDgsImV4cCI6MjA4MjQxODE0OH0.EPY7Oo_MIcJp40PRpkQ3tV3O8KPG2wZGonVRd6XrmR4'; 
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // R√©cup√©rer l'ID de la formation depuis l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const formationId = urlParams.get('id');

        // Charger la formation
        async function loadFormation() {
            if (!formationId) {
                window.location.href = 'formations.html';
                return;
            }

            // Charger la formation
            const { data: formation, error } = await supabaseClient
                .from('formations')
                .select('*')
                .eq('id', formationId)
                .eq('published', true)
                .single();

            if (error || !formation) {
                document.getElementById('formation-detail').innerHTML = `
                    <div class="container">
                        <div class="error-state">
                            <h2>Formation non trouv√©e</h2>
                            <p>Cette formation n'existe pas ou n'est plus disponible.</p>
                            <a href="formations.html" class="btn btn-primary">Voir toutes les formations</a>
                        </div>
                    </div>
                `;
                return;
            }

            // Charger les modules
            const { data: modules } = await supabaseClient
                .from('modules')
                .select('*')
                .eq('formation_id', formationId)
                .order('ordre', { ascending: true });

            displayFormation(formation, modules || []);
            
            // Mettre √† jour le titre de la page
            document.title = `${formation.titre} - OP!`;
        }

        // Afficher la formation
        function displayFormation(formation, modules) {
            const container = document.getElementById('formation-detail');

            container.innerHTML = `
                <!-- Hero Formation -->
                <section class="formation-hero" ${formation.image_url ? `style="background-image: url('${formation.image_url}')"` : ''}>
                    <div class="formation-hero-overlay"></div>
                    <div class="container">
                        <a href="formations.html" class="back-link">‚Üê Retour aux formations</a>
                        <h1>${formation.titre}</h1>
                        ${formation.description ? `<p class="formation-description">${formation.description}</p>` : ''}
                        <div class="formation-meta-hero">
                            <span>üìñ ${modules.length} module(s)</span>
                            <span class="badge-gratuit">Gratuit</span>
                        </div>
                    </div>
                </section>

                <!-- Modules -->
                <section class="modules-section">
                    <div class="container">
                        <h2>Contenu de la formation</h2>
                        
                        ${modules.length > 0 ? `
                            <div class="modules-list-public">
                                ${modules.map((m, i) => `
                                    <div class="module-public" id="module-${m.id}">
                                        <div class="module-public-header" onclick="toggleModule('${m.id}')">
                                            <span class="module-number-public">${i + 1}</span>
                                            <span class="module-title-public">${m.titre}</span>
                                            <span class="module-type-badge">${getTypeLabel(m.type)}</span>
                                            <span class="module-toggle">‚ñº</span>
                                        </div>
                                        <div class="module-public-content" id="content-${m.id}" style="display: none;">
                                            ${renderModuleContent(m)}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="empty-modules">
                                <p>Les modules de cette formation arrivent bient√¥t !</p>
                            </div>
                        `}
                    </div>
                </section>

                <!-- CTA -->
                <section class="formation-cta">
                    <div class="container">
                        <div class="cta-box">
                            <h2>Des questions sur cette formation ?</h2>
                            <p>Contactez-nous pour en savoir plus ou pour un accompagnement personnalis√©.</p>
                            <a href="index.html#contact" class="btn btn-primary">Nous contacter</a>
                        </div>
                    </div>
                </section>
            `;
        }

        // Toggle module
        function toggleModule(id) {
            const content = document.getElementById(`content-${id}`);
            const module = document.getElementById(`module-${id}`);
            const isOpen = content.style.display !== 'none';
            
            content.style.display = isOpen ? 'none' : 'block';
            module.classList.toggle('open', !isOpen);
        }

        // Type label
        function getTypeLabel(type) {
            const labels = {
                'video': 'üé• Vid√©o',
                'pdf': 'üìÑ PDF',
                'texte': 'üìù Texte'
            };
            return labels[type] || type;
        }

        // Render module content
        function renderModuleContent(module) {
            switch(module.type) {
                case 'video':
                    if (module.contenu_url) {
                        // YouTube embed
                        if (module.contenu_url.includes('youtube.com') || module.contenu_url.includes('youtu.be')) {
                            const videoId = extractYouTubeId(module.contenu_url);
                            return `<div class="video-container"><iframe src="https://www.youtube.com/embed/${videoId}" allowfullscreen></iframe></div>`;
                        }
                        // Autre vid√©o
                        return `<video controls src="${module.contenu_url}"></video>`;
                    }
                    return '<p>Vid√©o non disponible</p>';
                    
                case 'pdf':
                    if (module.contenu_url) {
                        return `<a href="${module.contenu_url}" target="_blank" class="btn btn-secondary">üìÑ T√©l√©charger le PDF</a>`;
                    }
                    return '<p>PDF non disponible</p>';
                    
                case 'texte':
                    return `<div class="module-text-content">${module.contenu_texte || 'Contenu non disponible'}</div>`;
                    
                default:
                    return '<p>Contenu non disponible</p>';
            }
        }

        // Extract YouTube ID
        function extractYouTubeId(url) {
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = url.match(regex);
            return match ? match[1] : '';
        }

        // Init
        loadFormation();
    </script>
</body>
</html>